# create-frontend-app

CLI для инициализации микрофронтендов.

# Использование

Чтобы создать новое приложение, воспользуйтесь кнопкой "Use this template" в одном из следующих шаблонов:
- [Шаблон микрофронтенда](https://link.to.microfrontend.template)
- ...

После того как приложение будет создано, клонируйте его к себе на ПК и в корне приложения запустите команду:

```shell
npx create-frontend-app@latest
```

Далее следуйте шагам из CLI.

# Разработка и поддержка

Требуемая версия NodeJS: **18**.\
Требуемая версия NPM:    **9**.

1. Устанавливаем зависимости
   ```shell
   npm install
   ```
2. Запускаем проект в режиме разработки
   ```shell
   npm start
   ```

Проект написан с поддержкой нативного формата модулей ESM (ECMAScript Modules,
[подробнее](https://nodejs.org/api/esm.html)), будьте внимательнее!
Это нельзя менять во избежание неработоспособности.

## Отладка

Отладить CLI можно следующим образом:

1. Клонируем к себе шаблонный проект (список можно увидеть в п. "[Использование](#использование)")
2. Запускаем сервер разработки:
   ```shell
   npm start
   ```
3. Линкуем CLI в глобальную область NPM
   ```shell
   npm link
   ```
4. В соседней IDE или в терминале переходим в папку шаблонного проекта:
   ```shell
   cd path/to/template
   ```
5. Запускаем CLI:
   ```shell
   npx create-frontend-app [arguments]
   ```

## Структура проекта

В директории `src` находятся исходные файлы CLI.

Команды `npm run start` и `npm run build` компилируют их в один файл `dist/index.mjs`.

Это нужно, чтобы `package.json` распознал файл как исполняемый.

## Фичи (features)

CLI работает в полу-автоматическом режиме. Что это значит:

Когда запускается CLI, он ищет файл `package.json` в корне шаблонного проекта.
В `package.json` должно быть поле `mindbox.appType` содержащее одно из двух значений – `microfrontend` или `library`.

На основе этой информации CLI выбирает, какой режим генерации проекта запустить.

Эти фичи обслуживаются директориями в `src/features`.

В этих директориях присутствуют скрипты, которые исполняются **только** для соответствующей фичи – `microfrontend` или `library`.

Фичи также используют общие ресурсы (модули, вопросы, скрипты), которые хранятся в директории `src/shared`.

## Аргументы

CLI поддерживает некоторые аргументы.

Пример использования аргументов можно найти в подсказке:

```shell
npx create-frontend-app --help
```

На текущий момент доступны следующие аргументы:

| Аргумент                         | Описание                                                                                                                                                                                                      |
|----------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `--no-deps`                      | Отключает установку зависимостей (`dependencies` и `devDependencies`)                                                                                                                                         |
| `-n`<br>`--namespace`            | Позволяет указать `namespace` для микрофронтенда. Если `namespace` указан, то интерактивный вопрос о вводе неймспейса не будет выведен. Полезно, когда интерфейс терминала не поддерживает интерактивный ввод |
| `-npi`<br>`--no-post-info`       | Не показывает завершающую информацию после генерации проекта                                                                                                                                                  |
| `--verbose`                      | Выводит подробные логи на каждом этапе генерации приложения                                                                                                                                                   |

## Шаблоны

Для компиляции шаблонов используется язык шаблонов [Handlebars](https://handlebarsjs.com).

Программа доработана так, что шаблоны можно писать как в файлах, так и в названии файлов. Например:

```json5
// File data:
{
  "name": "<% projectName %>"
}
```

```text
// File path:

_% projectName %_.file.json
```

> В Windows символы "`<`" и "`>`" запрещены для использования в пути файла.
> Поэтому для шаблонов в пути файла происходит преобразование по другим тегам.
> Подробнее в классе [`src/shared/Template.ts`](src/shared/template/Template.ts).

## Хелперы для переменных

Handlebars поддерживает кастомные хелперы для преобразования переданных переменных ([подробнее про Custom Helpers](https://handlebarsjs.com/guide/#custom-helpers)).

CLI в данный момент поддерживает несколько хелперов:

| Хелпер       | Пример использования             | Результат рендера |
|--------------|----------------------------------|-------------------|
| `lowercase`  | `<% lowercase TestVariable %>`   | `testvariable`    |
| `uppercase`  | `<% uppercase TestVariable %>`   | `TESTVARIABLE`    |
| `camelcase`  | `<% camelcase test-variable %>`  | `testVariable`    |
| `pascalcase` | `<% pascalcase test-variable %>` | `TestVariable`    |
| `kebabcase`  | `<% kebabcase TestVariable %>`   | `test-variable`   |
| `snakecase`  | `<% snakecase TestVariable %>`   | `test_variable`   |

## Требования к сообщениям коммитов

Сообщения коммитов должны быть оформлены по [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/).
Это необходимо для корректной работы инструментов создания релизов и упаковки пакетов.
А так же для единообразия.
